
# Vulnerability Scanning Notes

## 1. Theory

### Stages of Vulnerability Scanning
1. **Host Discovery**
   ```bash
   sudo nmap -sn -Pn <ip range>   # -Pn treats all hosts as up
   ```
2. **Port Scanning**
   ```bash
   sudo nmap -p <port range> <ip>
   sudo nmap --top-ports=20 <ip>
   sudo nmap -sS -sU -p <range> <ip>
   ```
3. **OS, Service, and Version Detection**
   ```bash
   sudo nmap -O -sV <ip>
   ```
4. **Vulnerability Matching**
   - Use CVE databases or tools like Nessus/Nmap scripts.

### CVSS
- **CVSS**: Common Vulnerability Scoring System
- Use CVSS calculator if no score is pre-assigned.

### Manual vs Automated Scanning
- **Manual**: High effort, finds complex/logical vulns.
- **Automated**: Fast, scalable; best for known issues in large environments.

---

## 2. Types of Vulnerability Scans

| Type             | Description |
|------------------|-------------|
| **External**     | Scans from outside the network (DMZ/internet-facing). |
| **Internal**     | Scans via VPN or pivoted access inside the network. |
| **Unauthenticated** | No credentials; tests remotely accessible services only. |
| **Authenticated**   | Uses credentials; detects local flaws, missing patches, configs. |

---

## 3. Network Considerations

- **Scanning Duration**: External scans on large IP ranges can be slow.
- **Target Visibility**:
  - External: check firewall/VPN requirements
  - Internal: firewalls, IDS/IPS may filter traffic
- **Rate Limiting**: High-speed scans may cause missed results.
  - Solutions: increase timeouts, reduce parallelism, scan slower

---

## 4. Nessus

### Service Startup
```bash
sudo systemctl start nessusd.service
# Access via browser: https://127.0.0.1:8834
```

### Templates
- **Basic Network Scan**: Full broad scan (recommended)
- **Advanced Scan**: Fully customizable
- **Advanced Dynamic Scan**: CVE-based plugin targeting

### Scan Execution
- Go to Scans → New Scan → Choose Template
- Adjust port ranges if needed
- Setup SMTP if you want emailed reports

### Credentialed Scans
- **Linux/macOS**: Use SSH credentials
- **Windows**: Use SMB or WMI
- Reference: https://docs.tenable.com/nessus/Content/CredentialedChecksOnWindows.htm
- Set up privilege escalation methods in credential settings
- Beware of AV/firewall interference and UAC on Windows

---

## 5. Working with Plugins (Nessus)

- Use **Advanced Dynamic Scan**
- Filter plugins by CVE ID
- Select plugin families
- Use preview to see scope of each plugin

---

## 6. Vulnerability Scanning with Nmap

### NSE (Nmap Scripting Engine)

- Location: `/usr/share/nmap/scripts/`
- Index file: `script.db`
- Documentation: [https://nmap.org/nsedoc/](https://nmap.org/nsedoc/)

### Types
- **safe/vuln**: Safe checks with no risk
- **intrusive/vuln**: May crash services or destabilize the system

### Filtering NSE Scripts
```bash
cat script.db | grep ""type""
```

### Run a Vulnerability Script
```bash
sudo nmap -sV -p <port> --script "vuln" <ip>
```

> Match the correct port to the expected service. Use `-oG` for greppable output.

### Manual NSE Workflows
- Search CVEs to find NSE scripts
- Clone NSE scripts from GitHub if needed
  ```bash
  cp script.nse /usr/share/nmap/scripts/
  sudo nmap --script-updatedb
  ```

---
